<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>shen-gen • Mini ATS (TR/EN)</title>
  <style>
    :root{
      --bg:#060a18; --text:#eaf0ff; --muted:#9fb0e6; --line:rgba(255,255,255,.12);
      --card:rgba(255,255,255,.04); --card2:rgba(10,14,30,.55);
      --ok:#26d07c; --warn:#ffcc00; --bad:#ff5a5f; --accent:#6ea8ff;
      --shadow: 0 18px 40px rgba(0,0,0,.35);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(110,168,255,.28), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(38,208,124,.20), transparent 55%),
        radial-gradient(700px 600px at 60% 110%, rgba(255,204,0,.09), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      background: rgba(6,10,24,.82); backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .wrap{max-width:1280px; margin:0 auto; padding:14px 16px}
    .top{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
    .brand{display:flex; align-items:center; gap:12px}
    .brand h1{margin:0; font-size:22px; letter-spacing:.3px; text-transform:lowercase}
    .tag{display:block; margin-top:2px; font-size:12px; color:var(--muted)}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.03); font-size:12px; color:var(--muted)}
    .pill b{color:var(--text)}
    select, input, textarea, button{font:inherit}
    main{max-width:1280px; margin:0 auto; padding:16px}
    .tabs{display:flex; flex-wrap:wrap; gap:8px}
    .tab{padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03); cursor:pointer; font-weight:900; color:var(--muted)}
    .tab.active{background: rgba(110,168,255,.18); border-color: rgba(110,168,255,.45); color:var(--text)}
    .grid{display:grid; gap:12px; grid-template-columns:1fr 1fr}
    @media (max-width:1100px){.grid{grid-template-columns:1fr}}
    .card{
      border-radius:var(--r); border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      padding:14px; box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 10px; font-size:14px; color:#dfe6ff}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
    input, textarea, select{
      width:100%; border-radius:14px; border:1px solid var(--line); background: var(--card2); color:var(--text);
      padding:10px 12px; outline:none;
    }
    textarea{min-height:92px; resize:vertical; line-height:1.35}
    .row{display:grid; gap:10px; grid-template-columns:1fr 1fr}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
    .btns{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px}
    button{
      border:0; border-radius:14px; padding:10px 12px; cursor:pointer; font-weight:900;
      background: rgba(110,168,255,.18); color:var(--text); border:1px solid rgba(110,168,255,.35)
    }
    button.primary{
      background: linear-gradient(135deg, rgba(110,168,255,.95), rgba(38,208,124,.55));
      border-color: rgba(110,168,255,.55); color:#071022;
    }
    button.ghost{background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.12)}
    button.danger{background: rgba(255,90,95,.12); border-color: rgba(255,90,95,.30)}
    .muted{color:var(--muted); font-size:12px; line-height:1.45}
    .hr{height:1px; background: rgba(255,255,255,.08); margin:12px 0}
    .list{border:1px solid var(--line); background: rgba(10,14,30,.35); border-radius:var(--r); padding:12px}
    .list h3{margin:0 0 8px; font-size:13px; color:#dfe6ff}
    .table{width:100%; border-collapse:collapse; font-size:12px; overflow:hidden; border-radius:14px; border:1px solid var(--line)}
    .table th,.table td{border-bottom:1px solid rgba(255,255,255,.08); padding:10px; text-align:left; vertical-align:top}
    .table th{color:#cfe0ff; background: rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:0}
    .pill2{display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.04); font-size:11px}
    .pill2.ok{border-color:rgba(38,208,124,.55)}
    .pill2.warn{border-color:rgba(255,204,0,.55)}
    .pill2.bad{border-color:rgba(255,90,95,.55)}
    .hl{background: rgba(255,204,0,.22); padding:0 2px; border-radius:4px}
    .board{display:grid; gap:10px; grid-template-columns:repeat(6, 1fr)}
    @media (max-width:1200px){.board{grid-template-columns:repeat(3, 1fr)}}
    @media (max-width:720px){.board{grid-template-columns:1fr}}
    .col{border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.02);
      border-radius:var(--r); padding:10px; min-height:240px}
    .col h4{margin:0 0 8px; font-size:12px; color:#dfe6ff}
    .candCard{
      border:1px solid rgba(255,255,255,.12); background: rgba(10,14,30,.35);
      border-radius:14px; padding:10px; margin-top:8px; cursor:grab
    }
    .candCard b{display:block; font-size:12px}
    .candMeta{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
    .score{font-weight:1000}
    .qaGrid{display:grid; gap:10px}
    .qaCard{border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.02); border-radius:14px; padding:10px}
    .qaTop{display:flex; justify-content:space-between; gap:10px; align-items:center}
    .tiny{font-size:11px; color:var(--muted)}
    .footer{max-width:1280px; margin:0 auto; padding:0 16px 20px; color:var(--muted); font-size:11px}

    /* top help banner */
    .banner{
      margin-top:12px;
      border:1px solid rgba(110,168,255,.30);
      background: linear-gradient(135deg, rgba(110,168,255,.16), rgba(38,208,124,.08));
      border-radius:16px;
      padding:10px 12px;
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    .banner b{display:block}
    .banner .actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .kbd{font-size:11px; padding:3px 7px; border:1px solid rgba(255,255,255,.14); border-radius:10px; background:rgba(255,255,255,.03); color:var(--muted)}

    /* modal */
    .overlay{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; padding:16px; z-index:50}
    .modal{
      width:min(860px, 100%); border-radius:22px; border:1px solid rgba(255,255,255,.14);
      background: rgba(6,10,24,.92); backdrop-filter: blur(10px); box-shadow: var(--shadow);
      padding:16px;
    }
    .modal h2{margin:0 0 6px; font-size:16px}
    .modal .grid2{display:grid; grid-template-columns:1.2fr .8fr; gap:12px}
    @media (max-width:900px){.modal .grid2{grid-template-columns:1fr}}
    .step{border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.03); border-radius:16px; padding:12px}
    .step b{display:block; margin-bottom:6px}
    .closeX{float:right; cursor:pointer; padding:6px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.03); color:var(--text); font-weight:900}
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <!-- ✅ Yeni ilgi çekici shen-gen avatar (SVG, dosyasız) -->
        <svg width="46" height="46" viewBox="0 0 100 100" aria-label="shen-gen avatar" role="img" style="filter: drop-shadow(0 10px 22px rgba(0,0,0,.35)); border-radius:18px">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="rgba(110,168,255,1)"/>
              <stop offset="1" stop-color="rgba(38,208,124,1)"/>
            </linearGradient>
            <radialGradient id="g2" cx="40%" cy="30%" r="70%">
              <stop offset="0" stop-color="rgba(255,255,255,.18)"/>
              <stop offset="1" stop-color="rgba(255,255,255,0)"/>
            </radialGradient>
          </defs>
          <rect x="0" y="0" width="100" height="100" rx="26" fill="url(#g1)"/>
          <rect x="0" y="0" width="100" height="100" rx="26" fill="url(#g2)"/>
          <circle cx="50" cy="50" r="38" fill="rgba(6,10,24,.35)" stroke="rgba(255,255,255,.22)" stroke-width="2"/>
          <path d="M33 60c4 9 13 14 24 14 10 0 19-4 23-11 5-9-3-16-15-18l-7-1c-7-1-10-4-9-8 1-5 7-8 14-8 6 0 12 2 16 6"
                fill="none" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
          <text x="50" y="57" text-anchor="middle" font-size="26" font-weight="900" fill="rgba(255,255,255,.95)" style="letter-spacing:.5px">SG</text>
        </svg>

        <div>
          <h1>shen-gen</h1>
          <span class="tag" id="tagline">Mini ATS • Kanıtlı Ön Eleme • Pipeline • Karşılaştır • TR/EN</span>
        </div>
      </div>

      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
        <span class="pill"><span id="modeLbl">Mod</span>: <b id="modeVal">Deterministik</b></span>
        <span class="pill"><span id="outLbl">Çıktı</span>: <b id="outVal">Kanıtlı</b></span>
        <button class="ghost" id="openGuide">❓ <span id="helpBtnTxt">Nasıl Kullanılır</span></button>
        <select id="lang" style="max-width:170px">
          <option value="tr">Türkçe</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <!-- ✅ Kullanıcı yönlendirme banner (her ekranda görünür) -->
    <div class="banner" id="banner">
      <div>
        <b id="bannerTitle">Hızlı Başlangıç</b>
        <div class="muted" id="bannerText">
          1) Pozisyon oluştur → 2) Aday ekle → 3) “Eşleştir & Sırala” ile skor + kanıt gör → 4) Kısa liste + karşılaştır.
        </div>
      </div>
      <div class="actions">
        <span class="kbd">Jobs</span><span class="kbd">Candidates</span><span class="kbd">Match</span>
        <button class="ghost" id="hideBanner">✕ <span id="hideBannerTxt">Gizle</span></button>
      </div>
    </div>

    <div class="tabs" style="margin-top:12px">
      <div class="tab active" data-tab="jobs" id="tabJobs">Pozisyonlar</div>
      <div class="tab" data-tab="candidates" id="tabCand">Adaylar</div>
      <div class="tab" data-tab="match" id="tabMatch">Eşleştir & Sırala</div>
      <div class="tab" data-tab="pipeline" id="tabPipe">Süreç</div>
      <div class="tab" data-tab="compare" id="tabCompare">Karşılaştır</div>
      <div class="tab" data-tab="audit" id="tabAudit">Kayıt</div>
    </div>
  </div>
</header>

<main>
  <!-- JOBS -->
  <section class="page" id="page-jobs">
    <div class="grid">
      <div class="card">
        <h2 id="jobCreateTitle">Pozisyon Oluştur</h2>

        <div class="muted" id="jobIntro">
          Bu ekranda aradığın rolü tanımlarsın. Sonra aday ekleyip sistemin kanıtlı taramasını çalıştırırsın.
        </div>

        <label id="jobTitleLbl">Pozisyon Adı</label>
        <input id="jobTitle"/>

        <div class="row">
          <div>
            <label id="jobGroupLbl">Pozisyon Grubu</label>
            <select id="jobGroup">
              <option value="auto" id="grpAuto">Otomatik</option>
              <option value="tech">Teknoloji</option>
              <option value="product">Ürün / İş Analizi / PO</option>
              <option value="sales">Satış</option>
              <option value="finance">Finans</option>
              <option value="ops">Operasyon</option>
            </select>
          </div>
          <div>
            <label id="jobLocLbl">Lokasyon (opsiyonel)</label>
            <input id="jobLoc"/>
          </div>
        </div>

        <div class="row">
          <div>
            <label id="mustLbl">Olmazsa Olmazlar (virgülle)</label>
            <input id="jobMust"/>
            <div class="tiny" id="mustHint">Örn: SQL, API, Agile, BPMN</div>
          </div>
          <div>
            <label id="niceLbl">Artı Değerler (virgülle)</label>
            <input id="jobNice"/>
            <div class="tiny" id="niceHint">Örn: Jira, Confluence, Postman</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label id="redLbl">Kırmızı Bayraklar (virgülle)</label>
            <input id="jobRed"/>
            <div class="tiny" id="redHint">Örn: sahte, intihal</div>
          </div>
          <div>
            <label id="minYearsLbl">Minimum Deneyim (yıl)</label>
            <input id="jobMinYears" type="number" min="0" step="1"/>
          </div>
        </div>

        <label id="qSetLbl">Soru Seti (her satıra 1 soru)</label>
        <textarea id="jobQs"></textarea>
        <div class="tiny" id="qHint">Sistem her soruya “Kanıtlı / Muhtemel / Bulunamadı” üretir (kanıt snippet’iyle).</div>

        <div class="btns">
          <button class="primary" id="saveJob">Pozisyonu Kaydet</button>
          <button class="ghost" id="jobTemplate">Şablon</button>
          <button class="ghost" id="resetJob">Temizle</button>
        </div>
      </div>

      <div class="card">
        <h2 id="jobListTitle">Pozisyonlar</h2>
        <div class="list">
          <h3 id="jobSelectLbl">Pozisyon Seç</h3>
          <select id="jobSelect"></select>
          <div class="btns">
            <button class="danger" id="deleteJob">Sil</button>
            <button class="ghost" id="cloneJob">Kopyala</button>
          </div>
          <div class="hr"></div>
          <div class="muted" id="jobDetail">—</div>
        </div>
      </div>
    </div>
  </section>

  <!-- CANDIDATES -->
  <section class="page" id="page-candidates" style="display:none">
    <div class="grid">
      <div class="card">
        <h2 id="candCreateTitle">Aday Ekle</h2>

        <div class="muted" id="candIntro">
          CV’yi metin olarak yapıştırabilir veya TXT dosyası yükleyebilirsin. LinkedIn metnini de yapıştırabilirsin.
        </div>

        <label id="candNameLbl">Ad Soyad</label>
        <input id="candName"/>

        <div class="row">
          <div>
            <label id="candSourceLbl">Kaynak</label>
            <input id="candSource"/>
          </div>
          <div>
            <label id="candTagsLbl">Etiketler (virgülle)</label>
            <input id="candTags"/>
          </div>
        </div>

        <label id="cvTextLbl">CV Metni</label>
        <textarea id="candCV"></textarea>

        <div class="row">
          <div>
            <label id="cvFileLbl">CV TXT Yükle (opsiyonel)</label>
            <input id="cvFile" type="file" accept=".txt,text/plain"/>
            <div class="tiny" id="cvFileHint">PDF/DOCX için şimdilik metni kopyala-yapıştır kullan.</div>
          </div>
          <div>
            <label id="liTextLbl">LinkedIn Metni (opsiyonel)</label>
            <textarea id="candLI"></textarea>
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="saveCand">Adayı Kaydet</button>
          <button class="ghost" id="resetCand">Temizle</button>
        </div>
      </div>

      <div class="card">
        <h2 id="candListTitle">Adaylar</h2>
        <div class="list">
          <h3 id="candSelectLbl">Aday Seç</h3>
          <select id="candSelect"></select>
          <div class="btns">
            <button class="danger" id="deleteCand">Sil</button>
          </div>
          <div class="hr"></div>
          <div class="muted" id="candDetail">—</div>
        </div>
      </div>
    </div>
  </section>

  <!-- MATCH -->
  <section class="page" id="page-match" style="display:none">
    <div class="grid">
      <div class="card">
        <h2 id="matchTitle">Eşleştir & Sırala</h2>

        <div class="muted" id="matchIntro">
          Bu ekran “net çıktı” ekranıdır: skor + kanıt + soru-cevap aynı yerde.
        </div>

        <div class="row">
          <div>
            <label id="matchJobLbl">Pozisyon</label>
            <select id="matchJob"></select>
          </div>
          <div>
            <label id="matchWeightsLbl">Ağırlıklar</label>
            <div class="row">
              <input id="wMust" type="number" min="1" step="1" value="12" title="Must"/>
              <input id="wNice" type="number" min="1" step="1" value="5" title="Nice"/>
            </div>
            <div class="row">
              <input id="wYears" type="number" min="0" step="1" value="8" title="Years"/>
              <input id="wRed" type="number" min="0" step="1" value="10" title="Red penalty"/>
            </div>
            <div class="tiny" id="weightHint">İpucu: Must ağırlığı ↑ = daha katı filtreleme.</div>
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="runMatch">Eşleştirmeyi Çalıştır</button>
          <button class="ghost" id="pushShortlist">İlk 3 Adayı → Kısa Liste’ye Ekle</button>
          <button class="ghost" id="exportShortlist">Kısa Listeyi CSV İndir</button>
        </div>

        <div class="hr"></div>
        <div class="list">
          <h3 id="rankLbl">Sıralama</h3>
          <div class="muted" id="rankEmpty">
            Henüz skor yok. “Eşleştirmeyi Çalıştır” butonuna bas.
          </div>
          <div id="ranking"></div>
        </div>
      </div>

      <div class="card">
        <h2 id="matchDetailTitle">Kanıtlar ve Soru-Cevap</h2>
        <div class="list">
          <h3 id="pickAppLbl">Sıralamadan Aday Seç</h3>
          <select id="appSelect"></select>

          <div class="hr"></div>
          <div id="scoreBadge" class="muted">—</div>

          <div class="hr"></div>
          <h3 id="qaLbl">Soru-Cevap (Kanıtlı)</h3>
          <div id="qaHost" class="qaGrid"></div>

          <div class="hr"></div>
          <h3 id="eviLbl">Skor Kartı Kanıtları</h3>
          <table class="table" id="eviTable">
            <thead><tr><th>Kriter</th><th>Durum</th><th>Kanıt</th></tr></thead>
            <tbody><tr><td colspan="3" class="muted">—</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- PIPELINE -->
  <section class="page" id="page-pipeline" style="display:none">
    <div class="card">
      <h2 id="pipeTitle">Süreç (Pipeline)</h2>
      <div class="row">
        <div>
          <label id="pipeJobLbl">Pozisyon</label>
          <select id="pipeJob"></select>
        </div>
        <div>
          <label id="pipeHintLbl">İpucu</label>
          <div class="muted" id="pipeHint">Adayları aşamalar arasında sürükle-bırak yap. Tüm hareketler kayıt altındadır.</div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="board" id="board"></div>
    </div>
  </section>

  <!-- COMPARE -->
  <section class="page" id="page-compare" style="display:none">
    <div class="grid">
      <div class="card">
        <h2 id="compareTitle">Karşılaştır</h2>
        <label id="cmpJobLbl">Pozisyon</label>
        <select id="cmpJob"></select>

        <div class="row">
          <div>
            <label id="cmpALbl">Aday A</label>
            <select id="cmpA"></select>
          </div>
          <div>
            <label id="cmpBLbl">Aday B</label>
            <select id="cmpB"></select>
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="runCompare">Karşılaştır</button>
        </div>

        <div class="hr"></div>
        <div class="list">
          <h3 id="cmpOutLbl">Sonuç</h3>
          <div id="cmpOut" class="muted">—</div>
        </div>
      </div>

      <div class="card">
        <h2 id="cmpQaTitle">Soru-Cevap Yan Yana</h2>
        <div class="row">
          <div class="list">
            <h3 id="cmpQaA">A</h3>
            <div id="cmpQaHostA" class="qaGrid"></div>
          </div>
          <div class="list">
            <h3 id="cmpQaB">B</h3>
            <div id="cmpQaHostB" class="qaGrid"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- AUDIT -->
  <section class="page" id="page-audit" style="display:none">
    <div class="card">
      <h2 id="auditTitle">Kayıt (Audit)</h2>
      <div class="muted" id="auditIntro">
        Yapılan her kritik işlem (eşleştirme, stage değişimi vb.) burada kayıt altına alınır.
      </div>
      <div class="hr"></div>
      <div class="list">
        <h3 id="auditListLbl">İşlemler</h3>
        <div id="auditList" class="muted">—</div>
      </div>
      <div class="btns">
        <button class="ghost" id="clearAudit">Kayıtları Temizle</button>
        <button class="danger" id="clearAll">Tüm Veriyi Sıfırla</button>
      </div>
    </div>
  </section>
</main>

<div class="footer" id="footer">
  Bu MVP “kanıtlı / deterministik” çalışır. PDF/DOCX okuma istersen (pdf.js + mammoth) ekleyebiliriz.
</div>

<!-- ✅ Onboarding / Nasıl Kullanılır modal -->
<div class="overlay" id="overlay">
  <div class="modal">
    <button class="closeX" id="closeGuide">✕</button>
    <h2 id="guideTitle">shen-gen Nasıl Kullanılır?</h2>
    <div class="muted" id="guideSubtitle">3 dakikada net çıktı alacağın akış</div>
    <div class="hr"></div>

    <div class="grid2">
      <div class="step">
        <b id="g1t">1) Pozisyon oluştur</b>
        <div class="muted" id="g1d">
          Olmazsa Olmazlar, Artı Değerler ve Soru Setini gir. Soru seti “kanıtlı Q&A” üretir.
        </div>
      </div>

      <div class="step">
        <b id="g2t">2) Aday ekle</b>
        <div class="muted" id="g2d">
          CV metnini yapıştır veya TXT yükle. LinkedIn metnini de yapıştırabilirsin.
        </div>
      </div>

      <div class="step">
        <b id="g3t">3) Eşleştir & Sırala</b>
        <div class="muted" id="g3d">
          Skor + kanıt + soru cevap aynı yerde. Sistem “metinde bulamadığını” açıkça söyler.
        </div>
      </div>

      <div class="step">
        <b id="g4t">4) Kısa liste + karşılaştır</b>
        <div class="muted" id="g4d">
          İlk 3’ü kısa listeye at, pipeline’da ilerlet, Compare ekranında A vs B bak, CSV indir.
        </div>
      </div>

      <div class="step">
        <b id="g5t">Güven kuralı</b>
        <div class="muted" id="g5d">
          “Uydurma yok”: Her çıktı kanıta dayanır (snippet). Kanıt yoksa “Bulunamadı” der.
        </div>
      </div>

      <div class="step">
        <b id="g6t">Hızlı demo (isteğe bağlı)</b>
        <div class="muted" id="g6d">
          “Şablon” ile pozisyonu doldur, 1-2 aday metni yapıştır, eşleştirmeyi çalıştır.
        </div>
        <div class="btns">
          <button class="primary" id="demoFill">Demo doldur</button>
          <button class="ghost" id="goMatch">Match ekranına git</button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* =========================
   i18n
========================= */
const I18N = {
  tr: {
    tagline:"Mini ATS • Kanıtlı Ön Eleme • Aday Havuzu • Pipeline • Karşılaştır • TR/EN",
    modeLbl:"Mod", modeVal:"Deterministik",
    outLbl:"Çıktı", outVal:"Kanıtlı (Uydurma yok)",
    helpBtn:"Nasıl Kullanılır",

    bannerTitle:"Hızlı Başlangıç",
    bannerText:"1) Pozisyon oluştur → 2) Aday ekle → 3) “Eşleştir & Sırala” ile skor + kanıt gör → 4) Kısa liste + karşılaştır.",
    hideBanner:"Gizle",

    tabs:{jobs:"Pozisyonlar", candidates:"Adaylar", match:"Eşleştir & Sırala", pipeline:"Süreç (Pipeline)", compare:"Karşılaştır", audit:"Kayıt (Audit)"},

    jobs:{
      create:"Pozisyon Oluştur",
      intro:"Bu ekranda aradığın rolü tanımlarsın. Sonra aday ekleyip sistemin kanıtlı taramasını çalıştırırsın.",
      list:"Pozisyonlar", select:"Pozisyon Seç",
      title:"Pozisyon Adı", group:"Pozisyon Grubu", loc:"Lokasyon (opsiyonel)",
      must:"Olmazsa Olmazlar (virgülle)", mustHint:"Örn: SQL, API, Agile, BPMN",
      nice:"Artı Değerler (virgülle)", niceHint:"Örn: Jira, Confluence, Postman",
      red:"Kırmızı Bayraklar (virgülle)", redHint:"Örn: sahte, intihal",
      years:"Minimum Deneyim (yıl)",
      qs:"Soru Seti (her satıra 1 soru)", qHint:"Sistem her soruya “Kanıtlı / Muhtemel / Bulunamadı” üretir (kanıt snippet’iyle).",
      save:"Pozisyonu Kaydet", tpl:"Şablon", reset:"Temizle", del:"Sil", clone:"Kopyala"
    },

    cand:{
      create:"Aday Ekle",
      intro:"CV’yi metin olarak yapıştırabilir veya TXT dosyası yükleyebilirsin. LinkedIn metnini de yapıştırabilirsin.",
      list:"Adaylar", select:"Aday Seç",
      name:"Ad Soyad", source:"Kaynak", tags:"Etiketler (virgülle)",
      cv:"CV Metni", cvFile:"CV TXT Yükle (opsiyonel)", cvFileHint:"PDF/DOCX için şimdilik metni kopyala-yapıştır kullan.",
      li:"LinkedIn Metni (opsiyonel)",
      save:"Adayı Kaydet", reset:"Temizle", del:"Sil"
    },

    match:{
      title:"Eşleştir & Sırala",
      intro:"Bu ekran “net çıktı” ekranıdır: skor + kanıt + soru-cevap aynı yerde.",
      job:"Pozisyon", weights:"Ağırlıklar", weightHint:"İpucu: Must ağırlığı ↑ = daha katı filtreleme.",
      run:"Eşleştirmeyi Çalıştır", push:"İlk 3 Adayı → Kısa Liste’ye Ekle", export:"Kısa Listeyi CSV İndir",
      ranking:"Sıralama", rankEmpty:"Henüz skor yok. “Eşleştirmeyi Çalıştır” butonuna bas.",
      pick:"Sıralamadan Aday Seç",
      detailTitle:"Kanıtlar ve Soru-Cevap",
      qa:"Soru-Cevap (Kanıtlı)", evi:"Skor Kartı Kanıtları",
      cols:{crit:"Kriter", status:"Durum", ev:"Kanıt"}
    },

    pipe:{ title:"Süreç (Pipeline)", job:"Pozisyon", hintLbl:"İpucu",
      hint:"Adayları aşamalar arasında sürükle-bırak yap. Tüm hareketler kayıt altındadır.",
      stages:["Yeni","Ön Eleme","Kısa Liste","Mülakat","Teklif","Reddedildi"]
    },

    cmp:{
      title:"Karşılaştır", job:"Pozisyon", a:"Aday A", b:"Aday B", run:"Karşılaştır",
      out:"Sonuç", qa:"Soru-Cevap Yan Yana"
    },

    audit:{
      title:"Kayıt (Audit)", intro:"Yapılan her kritik işlem (eşleştirme, stage değişimi vb.) burada kayıt altına alınır.",
      list:"İşlemler", clear:"Kayıtları Temizle", resetAll:"Tüm Veriyi Sıfırla"
    },

    guide:{
      title:"shen-gen Nasıl Kullanılır?",
      sub:"3 dakikada net çıktı alacağın akış",
      s1t:"1) Pozisyon oluştur", s1d:"Olmazsa Olmazlar, Artı Değerler ve Soru Setini gir. Soru seti “kanıtlı Q&A” üretir.",
      s2t:"2) Aday ekle", s2d:"CV metnini yapıştır veya TXT yükle. LinkedIn metnini de yapıştırabilirsin.",
      s3t:"3) Eşleştir & Sırala", s3d:"Skor + kanıt + soru cevap aynı yerde. Sistem “metinde bulamadığını” açıkça söyler.",
      s4t:"4) Kısa liste + karşılaştır", s4d:"İlk 3’ü kısa listeye at, pipeline’da ilerlet, Compare ekranında A vs B bak, CSV indir.",
      s5t:"Güven kuralı", s5d:"“Uydurma yok”: Her çıktı kanıta dayanır (snippet). Kanıt yoksa “Bulunamadı” der.",
      s6t:"Hızlı demo (isteğe bağlı)", s6d:"“Şablon” ile pozisyonu doldur, 1-2 aday metni yapıştır, eşleştirmeyi çalıştır.",
      demo:"Demo doldur", go:"Match ekranına git"
    },

    status:{fit:"Uygun", review:"İncele", weak:"Zayıf Eşleşme", confirmed:"Kanıtlı", likely:"Muhtemel", notfound:"Bulunamadı"},
    misc:{
      none:"—",
      notFound:"Metinde bulunamadı (veri eksik olabilir).",
      footer:"Bu MVP “kanıtlı / deterministik” çalışır. PDF/DOCX okuma istersen (pdf.js + mammoth) ekleyebiliriz."
    },
    placeholders:{
      jobTitle:"Örn: Kıdemli İş Analisti",
      jobLoc:"İstanbul / Uzaktan",
      must:"Örn: SQL, API, Agile, BPMN",
      nice:"Örn: Jira, Confluence, Postman",
      red:"Örn: sahte, intihal",
      candName:"Aday adı soyadı",
      source:"LinkedIn / Referans / Başvuru",
      tags:"Örn: Senior, Remote, FinTech",
      cv:"CV metnini yapıştır...",
      li:"LinkedIn About/Experience metnini yapıştır..."
    }
  },

  en: {
    tagline:"Mini ATS • Evidence-based Screening • Candidate Pool • Pipeline • Compare • TR/EN",
    modeLbl:"Mode", modeVal:"Deterministic",
    outLbl:"Output", outVal:"Evidence-based (No hallucination)",
    helpBtn:"How to Use",

    bannerTitle:"Quick Start",
    bannerText:"1) Create a job → 2) Add candidates → 3) Run “Match & Rank” for score + evidence → 4) Shortlist + compare.",
    hideBanner:"Hide",

    tabs:{jobs:"Jobs", candidates:"Candidates", match:"Match & Rank", pipeline:"Pipeline", compare:"Compare", audit:"Audit"},

    jobs:{
      create:"Create Job",
      intro:"Define the role here. Then add candidates and run evidence-based matching.",
      list:"Jobs", select:"Select job",
      title:"Job title", group:"Job group", loc:"Location (optional)",
      must:"Must-have (comma)", mustHint:"e.g. SQL, API, Agile, BPMN",
      nice:"Nice-to-have (comma)", niceHint:"e.g. Jira, Confluence, Postman",
      red:"Red flags (comma)", redHint:"e.g. fake, plagiarism",
      years:"Minimum experience (years)",
      qs:"Question set (one per line)", qHint:"For each question you get “Confirmed / Likely / Not found” with a snippet.",
      save:"Save Job", tpl:"Template", reset:"Clear", del:"Delete", clone:"Clone"
    },

    cand:{
      create:"Create Candidate",
      intro:"Paste CV text or upload a TXT file. You can also paste LinkedIn text.",
      list:"Candidates", select:"Select candidate",
      name:"Full name", source:"Source", tags:"Tags (comma)",
      cv:"CV text", cvFile:"Upload CV TXT (optional)", cvFileHint:"For PDF/DOCX, use copy-paste in this MVP.",
      li:"LinkedIn text (optional)",
      save:"Save Candidate", reset:"Clear", del:"Delete"
    },

    match:{
      title:"Match & Rank",
      intro:"This is the “clear output” screen: score + evidence + Q&A together.",
      job:"Job", weights:"Weights", weightHint:"Tip: higher Must weight = stricter filtering.",
      run:"Run Matching", push:"Push Top 3 → Shortlist", export:"Download Shortlist CSV",
      ranking:"Ranking", rankEmpty:"No scores yet. Click “Run Matching”.",
      pick:"Pick candidate from ranking",
      detailTitle:"Evidence & Q&A",
      qa:"Q&A (Evidence-based)", evi:"Scorecard Evidence",
      cols:{crit:"Criterion", status:"Status", ev:"Evidence"}
    },

    pipe:{ title:"Pipeline", job:"Job", hintLbl:"Hint",
      hint:"Drag-drop candidates between stages. All changes are logged.",
      stages:["New","Screened","Shortlist","Interview","Offer","Rejected"]
    },

    cmp:{ title:"Compare", job:"Job", a:"Candidate A", b:"Candidate B", run:"Compare", out:"Result", qa:"Q&A Side-by-side" },

    audit:{ title:"Audit", intro:"Every critical action (matching, stage changes, etc.) is logged here.",
      list:"Events", clear:"Clear Audit", resetAll:"Reset All Data"
    },

    guide:{
      title:"How to use shen-gen?",
      sub:"Get a clear output in 3 minutes",
      s1t:"1) Create a job", s1d:"Enter Must/Nice and a question set for evidence-based Q&A.",
      s2t:"2) Add candidates", s2d:"Paste CV text or upload TXT. Optionally paste LinkedIn text.",
      s3t:"3) Match & Rank", s3d:"Score + evidence + Q&A in one place. If it’s not in the text, it says so.",
      s4t:"4) Shortlist + compare", s4d:"Push top 3 to shortlist, move in pipeline, compare A vs B, export CSV.",
      s5t:"Trust rule", s5d:"No hallucinations: Every output is backed by an evidence snippet. Otherwise: Not found.",
      s6t:"Quick demo (optional)", s6d:"Use “Template”, paste 1-2 candidates, run matching.",
      demo:"Fill demo", go:"Go to Match"
    },

    status:{fit:"Fit", review:"Review", weak:"Weak match", confirmed:"Confirmed", likely:"Likely", notfound:"Not found"},
    misc:{
      none:"—",
      notFound:"Not found in text (data may be missing).",
      footer:"This MVP is deterministic & evidence-based. If you want PDF/DOCX parsing, we can add pdf.js + mammoth."
    },
    placeholders:{
      jobTitle:"e.g. Senior Business Analyst",
      jobLoc:"Istanbul / Remote",
      must:"e.g. SQL, API, Agile, BPMN",
      nice:"e.g. Jira, Confluence, Postman",
      red:"e.g. fake, plagiarism",
      candName:"Candidate full name",
      source:"LinkedIn / Referral / Application",
      tags:"e.g. Senior, Remote, FinTech",
      cv:"Paste CV text...",
      li:"Paste LinkedIn About/Experience text..."
    }
  }
};
let LANG = "tr";
function t(path){
  const parts = path.split(".");
  let cur = I18N[LANG];
  for(const p of parts){ cur = cur?.[p]; }
  return cur ?? path;
}

/* =========================
   Storage
========================= */
const KEY = "shen_gen_app_v2";
function loadDB(){
  const raw = localStorage.getItem(KEY);
  if(raw) return JSON.parse(raw);
  return { jobs:[], candidates:[], applications:[], audit:[], ui:{bannerHidden:false, guideSeen:false} };
}
function saveDB(){ localStorage.setItem(KEY, JSON.stringify(DB)); }
let DB = loadDB();

function uid(prefix){ return prefix + "_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16); }
function nowISO(){ return new Date().toISOString(); }
function logAudit(action, entityType, entityId, before, after){
  DB.audit.unshift({ id:uid("aud"), ts:nowISO(), action, entityType, entityId, before, after });
  saveDB();
  renderAudit();
}

/* =========================
   Utils
========================= */
const $ = (id)=>document.getElementById(id);
function csvToList(s){ return (s||"").split(",").map(x=>x.trim()).filter(Boolean).filter((v,i,a)=>a.indexOf(v)===i); }
function norm(s){ return (s||"").toLowerCase().replace(/\s+/g," ").trim(); }
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
function escapeHtml(str){ return (str||"").replace(/[&<>"']/g, (m)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])); }
function findEvidence(text, keyword){
  const raw = text || "";
  const idx = norm(raw).indexOf(norm(keyword));
  if(idx === -1) return "";
  const start = Math.max(0, idx - 90);
  const end = Math.min(raw.length, idx + keyword.length + 90);
  return raw.slice(start, end).replace(/\s+/g," ").trim();
}
function highlightSnippet(snippet, q){
  if(!snippet) return "";
  const qq = (q||"").trim();
  if(!qq) return escapeHtml(snippet);
  const tokens = qq.split(/\s+/).filter(Boolean).slice(0,8);
  let out = escapeHtml(snippet);
  for(const tok of tokens){
    const re = new RegExp(tok.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"), "gi");
    out = out.replace(re, (m)=>`<span class="hl">${m}</span>`);
  }
  return out;
}
function extractYears(text){
  const tN = norm(text);
  const m1 = tN.match(/(\d{1,2})\s*(yıl|years|year)\b/);
  if(m1) return parseInt(m1[1],10);
  const years = [...tN.matchAll(/\b(19\d{2}|20\d{2})\b/g)].map(m=>parseInt(m[1],10));
  if(years.length >= 2){
    const minY = Math.min(...years), maxY = Math.max(...years);
    const diff = maxY - minY;
    if(diff >= 1 && diff <= 40) return diff;
  }
  return null;
}

/* =========================
   Synonyms (tiny MVP)
========================= */
const SYN = {
  global: {
    "agile":["scrum","kanban","sprint","retrospective","standup"],
    "api":["rest","soap","graphql","endpoint","swagger","openapi"],
    "sql":["postgres","oracle","mssql","mysql","query","sorgu"],
    "leadership":["team lead","takım lideri","managed","yönetti","mentoring","mentorluk"],
    "crm":["salesforce","dynamics","hubspot","müşteri ilişkileri"],
    "kpi":["okr","metrics","hedef","performans"],
    "kyc":["aml","masak","know your customer","kimlik doğrulama","nfc","liveness"],
    "devops":["ci/cd","pipeline","docker","kubernetes","terraform","helm"]
  },
  tech: {
    "javascript":["js","typescript","ts","node","react","vue","angular"],
    "microservices":["kafka","event-driven","rabbitmq","service mesh"],
    "cloud":["aws","azure","gcp","k8s","kubernetes"]
  },
  product: {
    "bpmn":["process modeling","süreç modelleme","uml","workflow"],
    "product owner":["po","ürün sahibi","backlog","roadmap","discovery","mvp"]
  },
  sales: {
    "pipeline":["lead","prospecting","qualification","closing","crm"],
    "marketing":["seo","performance marketing","growth","acquisition"]
  },
  finance: {
    "reporting":["financial statements","bilanço","gelir tablosu","ifrs","gaap"],
    "risk":["credit risk","market risk","var","stress test","compliance"]
  },
  ops: {
    "support":["ticket","sla","incident","itil","problem management"],
    "operations":["reconciliation","mutabakat","settlement","back office"]
  }
};
function getSynPack(jobGroup){
  const base = {...SYN.global};
  const extra = SYN[jobGroup] || {};
  for(const k of Object.keys(extra)){
    base[k] = (base[k] || []).concat(extra[k]);
  }
  return base;
}

/* =========================
   Screening: QA + Scorecard
========================= */
function answerQuestion(combinedText, q, synPack){
  const tN = norm(combinedText);
  const exact = findEvidence(combinedText, q);
  if(exact){
    return { level:"ok", label:t("status.confirmed"), evidence: exact };
  }
  const tokens = (q||"").toLowerCase().split(/[^a-z0-9ğüşöçıİĞÜŞÖÇ]+/i).map(x=>x.trim()).filter(x=>x.length>=3);
  for(const tok of tokens){
    if(tN.includes(tok)){
      const ev = findEvidence(combinedText, tok);
      return { level:"ok", label:t("status.confirmed"), evidence: ev || "" };
    }
  }
  const qN = norm(q);
  for(const key of Object.keys(synPack)){
    const variants = [key].concat(synPack[key]||[]);
    const hitInQ = variants.some(v=> qN.includes(norm(v)));
    if(hitInQ){
      for(const v of variants){
        if(tN.includes(norm(v))){
          const ev = findEvidence(combinedText, v);
          return { level:"warn", label:t("status.likely"), evidence: ev || "" };
        }
      }
    }
  }
  return { level:"bad", label:t("status.notfound"), evidence:"" };
}

function scorecard(job, candidate, weights){
  const combined = (candidate.cvText||"") + "\n" + (candidate.liText||"");
  const combinedN = norm(combined);

  const must = job.must || [];
  const nice = job.nice || [];
  const red  = job.red  || [];

  const evidence = [];
  let mustHit=0, niceHit=0, redHit=0;

  for(const k of must){
    const hit = combinedN.includes(norm(k));
    if(hit) mustHit++;
    evidence.push({type:"Must", key:k, hit, ev: hit ? findEvidence(combined, k) : ""});
  }
  for(const k of nice){
    const hit = combinedN.includes(norm(k));
    if(hit) niceHit++;
    evidence.push({type:"Nice", key:k, hit, ev: hit ? findEvidence(combined, k) : ""});
  }
  for(const k of red){
    const hit = combinedN.includes(norm(k));
    if(hit) redHit++;
    evidence.push({type:"Red", key:k, hit, ev: hit ? findEvidence(combined, k) : ""});
  }

  const years = extractYears(combined);
  const minYears = Number(job.minYears || 0);
  const loc = norm(job.location || "");
  const locOk = loc ? combinedN.includes(loc) : true;

  const mustCount = must.length || 0;
  const niceCount = nice.length || 0;
  const mustRatio = mustCount ? (mustHit/mustCount) : 0.60;
  const niceRatio = niceCount ? (niceHit/niceCount) : 0.40;

  let points=0, max=0;
  const mustBlock = weights.wMust * (mustCount ? mustCount : 5);
  max += mustBlock; points += mustBlock * mustRatio;

  const niceBlock = weights.wNice * (niceCount ? niceCount : 6);
  max += niceBlock; points += niceBlock * niceRatio;

  max += weights.wYears;
  if(minYears>0){
    if(years==null) points += weights.wYears*0.35;
    else points += (years>=minYears) ? weights.wYears : weights.wYears * clamp(years/minYears,0,1);
  } else points += weights.wYears*0.6;

  max += 4;
  points += loc ? (locOk ? 4 : 1.5) : 2.5;

  points -= (redHit * weights.wRed);

  const score = clamp(Math.round((points/max)*100),0,100);

  let bucket = t("status.weak");
  if(score >= 75) bucket = t("status.fit");
  else if(score >= 55) bucket = t("status.review");

  return { score, bucket, meta:{mustHit,mustCount,niceHit,niceCount,redHit,years,locOk}, evidence };
}

function buildQA(job, candidate){
  const syn = getSynPack(job.group || "auto");
  const combined = (candidate.cvText||"") + "\n" + (candidate.liText||"");
  const qs = job.questions || [];
  const out = qs.map(q=>{
    const a = answerQuestion(combined, q, syn);
    return { q, ...a };
  });
  return out;
}

/* =========================
   Rendering
========================= */
function applyLang(){
  $("tagline").textContent = t("tagline");
  $("modeLbl").textContent = t("modeLbl");
  $("modeVal").textContent = t("modeVal");
  $("outLbl").textContent = t("outLbl");
  $("outVal").textContent = t("outVal");
  $("helpBtnTxt").textContent = t("helpBtn");

  $("bannerTitle").textContent = t("bannerTitle");
  $("bannerText").textContent = t("bannerText");
  $("hideBannerTxt").textContent = t("hideBanner");

  $("tabJobs").textContent = t("tabs.jobs");
  $("tabCand").textContent = t("tabs.candidates");
  $("tabMatch").textContent = t("tabs.match");
  $("tabPipe").textContent = t("tabs.pipeline");
  $("tabCompare").textContent = t("tabs.compare");
  $("tabAudit").textContent = t("tabs.audit");

  // Jobs
  $("jobCreateTitle").textContent = t("jobs.create");
  $("jobIntro").textContent = t("jobs.intro");
  $("jobListTitle").textContent = t("jobs.list");
  $("jobSelectLbl").textContent = t("jobs.select");
  $("jobTitleLbl").textContent = t("jobs.title");
  $("jobGroupLbl").textContent = t("jobs.group");
  $("jobLocLbl").textContent = t("jobs.loc");
  $("mustLbl").textContent = t("jobs.must");
  $("mustHint").textContent = t("jobs.mustHint");
  $("niceLbl").textContent = t("jobs.nice");
  $("niceHint").textContent = t("jobs.niceHint");
  $("redLbl").textContent = t("jobs.red");
  $("redHint").textContent = t("jobs.redHint");
  $("minYearsLbl").textContent = t("jobs.years");
  $("qSetLbl").textContent = t("jobs.qs");
  $("qHint").textContent = t("jobs.qHint");
  $("saveJob").textContent = t("jobs.save");
  $("jobTemplate").textContent = t("jobs.tpl");
  $("resetJob").textContent = t("jobs.reset");
  $("deleteJob").textContent = t("jobs.del");
  $("cloneJob").textContent = t("jobs.clone");
  $("grpAuto").textContent = (LANG==="tr") ? "Otomatik" : "Auto";

  // Candidates
  $("candCreateTitle").textContent = t("cand.create");
  $("candIntro").textContent = t("cand.intro");
  $("candListTitle").textContent = t("cand.list");
  $("candSelectLbl").textContent = t("cand.select");
  $("candNameLbl").textContent = t("cand.name");
  $("candSourceLbl").textContent = t("cand.source");
  $("candTagsLbl").textContent = t("cand.tags");
  $("cvTextLbl").textContent = t("cand.cv");
  $("cvFileLbl").textContent = t("cand.cvFile");
  $("cvFileHint").textContent = t("cand.cvFileHint");
  $("liTextLbl").textContent = t("cand.li");
  $("saveCand").textContent = t("cand.save");
  $("resetCand").textContent = t("cand.reset");
  $("deleteCand").textContent = t("cand.del");

  // Match
  $("matchTitle").textContent = t("match.title");
  $("matchIntro").textContent = t("match.intro");
  $("matchJobLbl").textContent = t("match.job");
  $("matchWeightsLbl").textContent = t("match.weights");
  $("weightHint").textContent = t("match.weightHint");
  $("runMatch").textContent = t("match.run");
  $("pushShortlist").textContent = t("match.push");
  $("exportShortlist").textContent = t("match.export");
  $("rankLbl").textContent = t("match.ranking");
  $("rankEmpty").textContent = t("match.rankEmpty");
  $("matchDetailTitle").textContent = t("match.detailTitle");
  $("pickAppLbl").textContent = t("match.pick");
  $("qaLbl").textContent = t("match.qa");
  $("eviLbl").textContent = t("match.evi");
  // table headers
  const ths = $("eviTable").querySelectorAll("thead th");
  ths[0].textContent = t("match.cols.crit");
  ths[1].textContent = t("match.cols.status");
  ths[2].textContent = t("match.cols.ev");

  // Pipeline
  $("pipeTitle").textContent = t("pipe.title");
  $("pipeJobLbl").textContent = t("pipe.job");
  $("pipeHintLbl").textContent = t("pipe.hintLbl");
  $("pipeHint").textContent = t("pipe.hint");

  // Compare
  $("compareTitle").textContent = t("cmp.title");
  $("cmpJobLbl").textContent = t("cmp.job");
  $("cmpALbl").textContent = t("cmp.a");
  $("cmpBLbl").textContent = t("cmp.b");
  $("runCompare").textContent = t("cmp.run");
  $("cmpOutLbl").textContent = t("cmp.out");
  $("cmpQaTitle").textContent = t("cmp.qa");

  // Audit
  $("auditTitle").textContent = t("audit.title");
  $("auditIntro").textContent = t("audit.intro");
  $("auditListLbl").textContent = t("audit.list");
  $("clearAudit").textContent = t("audit.clear");
  $("clearAll").textContent = t("audit.resetAll");

  // Guide
  $("guideTitle").textContent = t("guide.title");
  $("guideSubtitle").textContent = t("guide.sub");
  $("g1t").textContent = t("guide.s1t"); $("g1d").textContent = t("guide.s1d");
  $("g2t").textContent = t("guide.s2t"); $("g2d").textContent = t("guide.s2d");
  $("g3t").textContent = t("guide.s3t"); $("g3d").textContent = t("guide.s3d");
  $("g4t").textContent = t("guide.s4t"); $("g4d").textContent = t("guide.s4d");
  $("g5t").textContent = t("guide.s5t"); $("g5d").textContent = t("guide.s5d");
  $("g6t").textContent = t("guide.s6t"); $("g6d").textContent = t("guide.s6d");
  $("demoFill").textContent = t("guide.demo");
  $("goMatch").textContent = t("guide.go");

  // placeholders
  $("jobTitle").placeholder = t("placeholders.jobTitle");
  $("jobLoc").placeholder = t("placeholders.jobLoc");
  $("jobMust").placeholder = t("placeholders.must");
  $("jobNice").placeholder = t("placeholders.nice");
  $("jobRed").placeholder = t("placeholders.red");
  $("candName").placeholder = t("placeholders.candName");
  $("candSource").placeholder = t("placeholders.source");
  $("candTags").placeholder = t("placeholders.tags");
  $("candCV").placeholder = t("placeholders.cv");
  $("candLI").placeholder = t("placeholders.li");

  $("footer").textContent = t("misc.footer");
}

function renderJobs(){
  const sel = $("jobSelect");
  const m1 = $("matchJob");
  const p1 = $("pipeJob");
  const c1 = $("cmpJob");
  [sel,m1,p1,c1].forEach(s=>{ s.innerHTML=""; });

  if(!DB.jobs.length){
    const opt = document.createElement("option");
    opt.value=""; opt.textContent = t("misc.none");
    [sel,m1,p1,c1].forEach(s=> s.appendChild(opt.cloneNode(true)));
    $("jobDetail").textContent = t("misc.none");
    return;
  }
  DB.jobs.forEach(j=>{
    const opt = document.createElement("option");
    opt.value=j.id; opt.textContent = j.title;
    [sel,m1,p1,c1].forEach(s=> s.appendChild(opt.cloneNode(true)));
  });
  if(!sel.value) sel.value = DB.jobs[0].id;
  if(!m1.value) m1.value = DB.jobs[0].id;
  if(!p1.value) p1.value = DB.jobs[0].id;
  if(!c1.value) c1.value = DB.jobs[0].id;
  renderJobDetail();
}

function renderJobDetail(){
  const id = $("jobSelect").value;
  const j = DB.jobs.find(x=>x.id===id);
  if(!j){ $("jobDetail").textContent = t("misc.none"); return; }
  $("jobDetail").innerHTML =
    `<b>${escapeHtml(j.title)}</b><br>
     group: ${escapeHtml(j.group||"auto")} • minYears: ${escapeHtml(String(j.minYears||0))} • location: ${escapeHtml(j.location||"")}<br>
     must: ${escapeHtml((j.must||[]).join(", "))}<br>
     nice: ${escapeHtml((j.nice||[]).join(", "))}<br>
     red: ${escapeHtml((j.red||[]).join(", "))}<br>
     questions: ${escapeHtml((j.questions||[]).length.toString())}`;
}

function renderCandidates(){
  const sel = $("candSelect");
  sel.innerHTML="";
  if(!DB.candidates.length){
    const opt = document.createElement("option");
    opt.value=""; opt.textContent=t("misc.none");
    sel.appendChild(opt);
    $("candDetail").textContent=t("misc.none");
    return;
  }
  DB.candidates.forEach(c=>{
    const opt = document.createElement("option");
    opt.value=c.id; opt.textContent=c.name || "(no name)";
    sel.appendChild(opt);
  });
  if(!sel.value) sel.value = DB.candidates[0].id;
  renderCandDetail();
}

function renderCandDetail(){
  const id = $("candSelect").value;
  const c = DB.candidates.find(x=>x.id===id);
  if(!c){ $("candDetail").textContent=t("misc.none"); return; }
  $("candDetail").innerHTML =
    `<b>${escapeHtml(c.name||"")}</b><br>
     source: ${escapeHtml(c.source||"")}<br>
     tags: ${escapeHtml((c.tags||[]).join(", "))}<br>
     cv chars: ${(c.cvText||"").length} • li chars: ${(c.liText||"").length}`;
}

function ensureApplication(jobId, candId){
  let a = DB.applications.find(x=>x.jobId===jobId && x.candId===candId);
  if(!a){
    a = { id:uid("app"), jobId, candId, stage:(LANG==="tr"?"Yeni":"New"), score:null, bucket:null, qa:[], evidence:[], updatedAt:nowISO() };
    DB.applications.push(a);
    saveDB();
    logAudit("APPLICATION_CREATE","Application",a.id,null,a);
  }
  return a;
}

/* =========================
   MATCH & RANK
========================= */
let LAST_RANK = [];
function runMatching(){
  const jobId = $("matchJob").value;
  const job = DB.jobs.find(j=>j.id===jobId);
  if(!job){ return; }

  const weights = {
    wMust:Number($("wMust").value||12),
    wNice:Number($("wNice").value||5),
    wYears:Number($("wYears").value||8),
    wRed:Number($("wRed").value||10)
  };

  const ranked = [];
  DB.candidates.forEach(c=>{
    const app = ensureApplication(job.id, c.id);
    const before = {...app};
    const sc = scorecard(job, c, weights);
    const qa = buildQA(job, c);

    app.score = sc.score;
    app.bucket = sc.bucket;
    app.evidence = sc.evidence;
    app.qa = qa;
    app.updatedAt = nowISO();

    ranked.push({appId:app.id, candId:c.id, score:sc.score, bucket:sc.bucket});
    logAudit("MATCH_RUN","Application",app.id,before,app);
  });

  ranked.sort((a,b)=>b.score-a.score);
  LAST_RANK = ranked;

  $("rankEmpty").style.display = ranked.length ? "none" : "block";
  $("ranking").innerHTML = ranked.map((r,i)=>{
    const c = DB.candidates.find(x=>x.id===r.candId);
    return `<div class="candCard" data-app="${r.appId}">
      <b>#${i+1} ${escapeHtml(c?.name||"")}</b>
      <div class="candMeta">
        <span class="pill2 ok">${escapeHtml(String(r.score))}</span>
        <span class="pill2 warn">${escapeHtml(r.bucket||"")}</span>
      </div>
    </div>`;
  }).join("") || "";

  const aSel = $("appSelect");
  aSel.innerHTML="";
  ranked.forEach(r=>{
    const c = DB.candidates.find(x=>x.id===r.candId);
    const opt = document.createElement("option");
    opt.value = r.appId;
    opt.textContent = `${c?.name||""} • ${r.score}`;
    aSel.appendChild(opt);
  });
  if(ranked.length) aSel.value = ranked[0].appId;
  renderAppDetail();
}

function renderAppDetail(){
  const appId = $("appSelect").value;
  const app = DB.applications.find(x=>x.id===appId);
  if(!app){ $("scoreBadge").textContent=t("misc.none"); return; }
  const cand = DB.candidates.find(c=>c.id===app.candId);
  $("scoreBadge").innerHTML = `<b>${escapeHtml(cand?.name||"")}</b> • score: <span class="score">${escapeHtml(String(app.score))}</span> • ${escapeHtml(app.bucket||"")}`;

  const qaHost = $("qaHost");
  qaHost.innerHTML = "";
  (app.qa||[]).forEach(item=>{
    const cls = item.level==="ok" ? "ok" : item.level==="warn" ? "warn" : "bad";
    const ev = item.evidence ? highlightSnippet(item.evidence, item.q) : `<span class="muted">${t("misc.notFound")}</span>`;
    qaHost.innerHTML += `
      <div class="qaCard">
        <div class="qaTop">
          <b>${escapeHtml(item.q)}</b>
          <span class="pill2 ${cls}">${escapeHtml(item.label)}</span>
        </div>
        <div class="tiny" style="margin-top:8px">${ev}</div>
      </div>`;
  });

  const tbody = $("eviTable").querySelector("tbody");
  tbody.innerHTML = "";
  (app.evidence||[]).forEach(r=>{
    const cls = r.hit ? "ok" : (r.type==="Red" ? "warn" : "bad");
    const status = r.hit ? (r.type==="Red" ? "⚠️" : "✅") : (r.type==="Red" ? "—" : "❌");
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><span class="pill2 ${r.type==="Red" ? "warn": ""}">${escapeHtml(r.type)}</span> <b>${escapeHtml(r.key)}</b></td>
      <td><span class="pill2 ${cls}">${status}</span></td>
      <td class="tiny">${r.hit ? highlightSnippet((r.ev||"").slice(0,220), r.key) : ""}</td>`;
    tbody.appendChild(tr);
  });
}

function pushTop3ToShortlist(){
  const top = LAST_RANK.slice(0,3);
  top.forEach(r=>{
    const app = DB.applications.find(x=>x.id===r.appId);
    if(!app) return;
    const before = {...app};
    app.stage = (LANG==="tr" ? "Kısa Liste" : "Shortlist");
    app.updatedAt = nowISO();
    logAudit("STAGE_SET","Application",app.id,before,app);
  });
  saveDB();
  renderPipeline();
}

function exportShortlistCSV(){
  const jobId = $("matchJob").value;
  const job = DB.jobs.find(j=>j.id===jobId);
  const shortlistStage = (LANG==="tr" ? "Kısa Liste" : "Shortlist");
  const apps = DB.applications.filter(a=>a.jobId===jobId && a.stage===shortlistStage);
  const rows = [["Job","Candidate","Score","Bucket","Stage","Source","Tags"]];
  apps.forEach(a=>{
    const c = DB.candidates.find(x=>x.id===a.candId);
    rows.push([job?.title||"", c?.name||"", String(a.score||""), a.bucket||"", a.stage, c?.source||"", (c?.tags||[]).join("|")]);
  });
  const csv = rows.map(r=>r.map(cell=>{
    const s = (cell||"").toString().replace(/"/g,'""');
    return `"${s}"`;
  }).join(",")).join("\n");

  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `shen-gen_shortlist_${(job?.title||"job").replace(/\s+/g,"_")}.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

/* =========================
   PIPELINE
========================= */
function renderPipeline(){
  const jobId = $("pipeJob").value;
  const job = DB.jobs.find(j=>j.id===jobId);
  const stages = t("pipe.stages");
  const board = $("board");
  board.innerHTML = "";

  stages.forEach(stage=>{
    const col = document.createElement("div");
    col.className = "col";
    col.dataset.stage = stage;
    col.innerHTML = `<h4>${escapeHtml(stage)}</h4><div class="muted tiny">${escapeHtml(job?.title||"")}</div>`;
    col.addEventListener("dragover", e=>e.preventDefault());
    col.addEventListener("drop", (e)=>{
      e.preventDefault();
      const appId = e.dataTransfer.getData("text/appId");
      const app = DB.applications.find(x=>x.id===appId);
      if(!app) return;
      const before = {...app};
      app.stage = stage;
      app.updatedAt = nowISO();
      saveDB();
      logAudit("STAGE_DRAGDROP","Application",app.id,before,app);
      renderPipeline();
    });

    const apps = DB.applications.filter(a=>a.jobId===jobId && a.stage===stage)
      .sort((a,b)=>(b.score||0)-(a.score||0));
    apps.forEach(a=>{
      const c = DB.candidates.find(x=>x.id===a.candId);
      const card = document.createElement("div");
      card.className = "candCard";
      card.draggable = true;
      card.addEventListener("dragstart", (e)=>{ e.dataTransfer.setData("text/appId", a.id); });
      card.innerHTML = `<b>${escapeHtml(c?.name||"")}</b>
        <div class="candMeta">
          <span class="pill2 ok">${escapeHtml(String(a.score ?? ""))}</span>
          <span class="pill2 warn">${escapeHtml(a.bucket||"")}</span>
        </div>`;
      col.appendChild(card);
    });

    board.appendChild(col);
  });
}

/* =========================
   COMPARE
========================= */
function renderCompareDropdowns(){
  const jobId = $("cmpJob").value;
  const aSel = $("cmpA"), bSel = $("cmpB");
  aSel.innerHTML = ""; bSel.innerHTML = "";
  const apps = DB.applications.filter(a=>a.jobId===jobId).sort((x,y)=>(y.score||0)-(x.score||0));
  apps.forEach(app=>{
    const c = DB.candidates.find(x=>x.id===app.candId);
    const opt = document.createElement("option");
    opt.value = app.id;
    opt.textContent = `${c?.name||""} • ${app.score ?? ""} • ${app.stage}`;
    aSel.appendChild(opt.cloneNode(true));
    bSel.appendChild(opt.cloneNode(true));
  });
  if(apps.length){
    aSel.value = apps[0].id;
    bSel.value = apps[Math.min(1, apps.length-1)].id;
  }
}

function runCompare(){
  const aId = $("cmpA").value;
  const bId = $("cmpB").value;
  const appA = DB.applications.find(x=>x.id===aId);
  const appB = DB.applications.find(x=>x.id===bId);
  if(!appA || !appB){ $("cmpOut").textContent=t("misc.none"); return; }

  const candA = DB.candidates.find(c=>c.id===appA.candId);
  const candB = DB.candidates.find(c=>c.id===appB.candId);

  if(appA.score === appB.score){
    $("cmpOut").textContent = (LANG==="tr") ? "Skorlar eşit. Kanıtları ve soru cevaplarını incele." : "Scores are equal. Review evidence and Q&A.";
  }else{
    const win = appA.score > appB.score ? candA?.name : candB?.name;
    $("cmpOut").innerHTML = `<span class="pill2 ok">${escapeHtml(win||"")}</span> • ${escapeHtml(String(appA.score))} vs ${escapeHtml(String(appB.score))}`;
  }

  $("cmpQaA").textContent = (candA?.name||"A");
  $("cmpQaB").textContent = (candB?.name||"B");

  function renderQA(host, qa){
    host.innerHTML = "";
    (qa||[]).forEach(item=>{
      const cls = item.level==="ok" ? "ok" : item.level==="warn" ? "warn" : "bad";
      const ev = item.evidence ? highlightSnippet(item.evidence, item.q) : `<span class="muted">${t("misc.notFound")}</span>`;
      host.innerHTML += `<div class="qaCard">
        <div class="qaTop"><b>${escapeHtml(item.q)}</b><span class="pill2 ${cls}">${escapeHtml(item.label)}</span></div>
        <div class="tiny" style="margin-top:8px">${ev}</div>
      </div>`;
    });
  }
  renderQA($("cmpQaHostA"), appA.qa);
  renderQA($("cmpQaHostB"), appB.qa);
}

/* =========================
   AUDIT
========================= */
function renderAudit(){
  const host = $("auditList");
  if(!DB.audit.length){ host.textContent = t("misc.none"); return; }
  host.innerHTML = DB.audit.slice(0,90).map(e=>{
    return `<div class="candCard">
      <b>${escapeHtml(e.action)}</b>
      <div class="tiny">${escapeHtml(e.ts)} • ${escapeHtml(e.entityType)}:${escapeHtml(e.entityId)}</div>
    </div>`;
  }).join("");
}

/* =========================
   Actions
========================= */
function saveJob(){
  const job = {
    id: uid("job"),
    title: $("jobTitle").value.trim() || (LANG==="tr" ? "Yeni Pozisyon" : "New Job"),
    group: $("jobGroup").value,
    location: $("jobLoc").value.trim(),
    must: csvToList($("jobMust").value),
    nice: csvToList($("jobNice").value),
    red: csvToList($("jobRed").value),
    minYears: Number($("jobMinYears").value || 0),
    questions: ($("jobQs").value||"").split("\n").map(x=>x.trim()).filter(Boolean),
    createdAt: nowISO()
  };
  DB.jobs.push(job);
  saveDB();
  logAudit("JOB_CREATE","Job",job.id,null,job);
  renderJobs();
  $("jobSelect").value = job.id;
  renderJobDetail();
}

function deleteJob(){
  const id = $("jobSelect").value;
  const job = DB.jobs.find(j=>j.id===id);
  if(!job) return;
  DB.jobs = DB.jobs.filter(j=>j.id!==id);
  DB.applications = DB.applications.filter(a=>a.jobId!==id);
  saveDB();
  logAudit("JOB_DELETE","Job",id,job,null);
  renderJobs(); renderCandidates();
}

function cloneJob(){
  const id = $("jobSelect").value;
  const job = DB.jobs.find(j=>j.id===id);
  if(!job) return;
  const copy = {...job, id:uid("job"), title: job.title + (LANG==="tr" ? " (kopya)" : " (copy)"), createdAt:nowISO()};
  DB.jobs.push(copy);
  saveDB();
  logAudit("JOB_CLONE","Job",copy.id,null,copy);
  renderJobs();
  $("jobSelect").value = copy.id;
  renderJobDetail();
}

function jobTemplate(){
  $("jobTitle").value = (LANG==="tr") ? "Kıdemli İş Analisti" : "Senior Business Analyst";
  $("jobGroup").value = "product";
  $("jobLoc").value = (LANG==="tr") ? "İstanbul / Uzaktan" : "Istanbul / Remote";
  $("jobMust").value = "business analysis, user story, acceptance criteria, BPMN, API, SQL, stakeholder";
  $("jobNice").value = "Jira, Confluence, Postman, microservices, KYC, AML";
  $("jobRed").value = (LANG==="tr") ? "sahte, intihal, alakasız" : "fake, plagiarism, unrelated";
  $("jobMinYears").value = 5;
  $("jobQs").value =
(LANG==="tr")
? `Liderlik / ekip yönetimi kanıtı var mı?
API entegrasyon tecrübesi var mı?
KYC/AML/MASAK benzeri tecrübe var mı?
Jira/Confluence gibi araçlar geçmiş mi?`
: `Is there evidence of leadership/team management?
Any API integration experience?
Any KYC/AML compliance experience?
Mentions tools like Jira/Confluence?`;
}

function resetJob(){
  ["jobTitle","jobLoc","jobMust","jobNice","jobRed","jobMinYears","jobQs"].forEach(id=>$(id).value="");
  $("jobGroup").value="auto";
}

function saveCandidate(){
  const cand = {
    id: uid("cand"),
    name: $("candName").value.trim() || (LANG==="tr" ? "İsimsiz Aday" : "Unnamed"),
    source: $("candSource").value.trim(),
    tags: csvToList($("candTags").value),
    cvText: $("candCV").value || "",
    liText: $("candLI").value || "",
    createdAt: nowISO()
  };
  DB.candidates.push(cand);
  saveDB();
  logAudit("CAND_CREATE","Candidate",cand.id,null,cand);
  renderCandidates();
  $("candSelect").value = cand.id;
  renderCandDetail();
}

function deleteCandidate(){
  const id = $("candSelect").value;
  const cand = DB.candidates.find(c=>c.id===id);
  if(!cand) return;
  DB.candidates = DB.candidates.filter(c=>c.id!==id);
  DB.applications = DB.applications.filter(a=>a.candId!==id);
  saveDB();
  logAudit("CAND_DELETE","Candidate",id,cand,null);
  renderCandidates(); renderJobs();
}

function resetCandidate(){
  ["candName","candSource","candTags","candCV","candLI"].forEach(id=>$(id).value="");
  $("cvFile").value = "";
}

function clearAudit(){
  DB.audit = [];
  saveDB();
  renderAudit();
}

function clearAll(){
  localStorage.removeItem(KEY);
  DB = loadDB();
  renderAll();
}

/* =========================
   Tabs
========================= */
function showTab(name){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  document.querySelector(`.tab[data-tab="${name}"]`)?.classList.add("active");
  document.getElementById("page-"+name).style.display = "block";
  if(name==="jobs") renderJobDetail();
  if(name==="candidates") renderCandDetail();
  if(name==="pipeline") renderPipeline();
  if(name==="compare") renderCompareDropdowns();
  if(name==="audit") renderAudit();
}
document.querySelectorAll(".tab").forEach(el=>{
  el.addEventListener("click", ()=>showTab(el.dataset.tab));
});

/* =========================
   Wiring
========================= */
$("lang").addEventListener("change", (e)=>{
  LANG = e.target.value;
  applyLang();
  renderAll();
});
$("saveJob").addEventListener("click", saveJob);
$("deleteJob").addEventListener("click", deleteJob);
$("cloneJob").addEventListener("click", cloneJob);
$("jobTemplate").addEventListener("click", jobTemplate);
$("resetJob").addEventListener("click", resetJob);
$("jobSelect").addEventListener("change", renderJobDetail);

$("saveCand").addEventListener("click", saveCandidate);
$("deleteCand").addEventListener("click", deleteCandidate);
$("resetCand").addEventListener("click", resetCandidate);
$("candSelect").addEventListener("change", renderCandDetail);

$("runMatch").addEventListener("click", runMatching);
$("appSelect").addEventListener("change", renderAppDetail);
$("pushShortlist").addEventListener("click", pushTop3ToShortlist);
$("exportShortlist").addEventListener("click", exportShortlistCSV);

$("pipeJob").addEventListener("change", renderPipeline);
$("cmpJob").addEventListener("change", renderCompareDropdowns);
$("runCompare").addEventListener("click", runCompare);

$("clearAudit").addEventListener("click", clearAudit);
$("clearAll").addEventListener("click", clearAll);

// CV TXT upload
$("cvFile").addEventListener("change", async (e)=>{
  const f = e.target.files?.[0];
  if(!f) return;
  const text = await f.text();
  $("candCV").value = text;
});

// Guide
function openGuide(){ $("overlay").style.display = "flex"; }
function closeGuide(){ $("overlay").style.display = "none"; DB.ui.guideSeen = true; saveDB(); }
$("openGuide").addEventListener("click", openGuide);
$("closeGuide").addEventListener("click", closeGuide);
$("overlay").addEventListener("click", (e)=>{ if(e.target.id==="overlay") closeGuide(); });

$("demoFill").addEventListener("click", ()=>{
  jobTemplate();
  // Seed candidates (short, safe demo)
  if(!DB.candidates.length){
    $("candName").value = (LANG==="tr") ? "Demo Aday 1" : "Demo Candidate 1";
    $("candSource").value = "LinkedIn";
    $("candTags").value = "Senior, FinTech";
    $("candCV").value = (LANG==="tr")
      ? "7 yıl iş analizi, Agile/Scrum, API entegrasyonları, SQL raporlama. Jira/Confluence kullandı. KYC/AML süreçleri tecrübesi."
      : "7 years BA, Agile/Scrum, API integrations, SQL reporting. Used Jira/Confluence. Experience with KYC/AML flows.";
    $("candLI").value = "";
    saveCandidate();

    $("candName").value = (LANG==="tr") ? "Demo Aday 2" : "Demo Candidate 2";
    $("candSource").value = "Referral";
    $("candTags").value = "Mid, Product";
    $("candCV").value = (LANG==="tr")
      ? "3 yıl ürün/analiz, user story yazımı, acceptance criteria. API geçti ama SQL yok. Jira var. KYC yok."
      : "3 years product/analysis, user stories, acceptance criteria. Mentions API but no SQL. Jira yes. No KYC.";
    $("candLI").value = "";
    saveCandidate();
  }
  showTab("jobs");
});
$("goMatch").addEventListener("click", ()=>{ closeGuide(); showTab("match"); });

// Banner
function syncBanner(){
  $("banner").style.display = DB.ui.bannerHidden ? "none" : "flex";
}
$("hideBanner").addEventListener("click", ()=>{
  DB.ui.bannerHidden = true; saveDB(); syncBanner();
});

/* =========================
   Initial render
========================= */
function renderAll(){
  applyLang();
  renderJobs();
  renderCandidates();
  renderAudit();

  // sync job selects
  $("matchJob").innerHTML = $("jobSelect").innerHTML;
  $("pipeJob").innerHTML = $("jobSelect").innerHTML;
  $("cmpJob").innerHTML = $("jobSelect").innerHTML;

  if($("jobSelect").value){
    $("matchJob").value = $("jobSelect").value;
    $("pipeJob").value = $("jobSelect").value;
    $("cmpJob").value = $("jobSelect").value;
  }
  renderPipeline();
  renderCompareDropdowns();
  syncBanner();
}

renderAll();
showTab("jobs");

// show guide first time
if(!DB.ui.guideSeen){
  setTimeout(openGuide, 250);
}
</script>
</body>
</html>
